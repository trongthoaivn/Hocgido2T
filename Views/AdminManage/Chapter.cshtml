
@{
    ViewBag.Title = "Chapter";
    Layout = "~/Views/Shared/_DashboardAdmin.cshtml";
}




<script src="~/Scripts/ckeditor/ckeditor.js"></script>
<script src="~/Scripts/crypto-js.min.js"></script>
<script src="~/Scripts/aes.min.js"></script>







<div class="container">
    <h2 id="titleChaptermodal">Bài học : <input class="form-control" type="text" id="txt_tenbh" /></h2>
    <br />
    <div class=" row">
        <div class="col-md-12">
            <div id="LyThuyet">
                <h5><b>Lý thuyết</b></h5>
                <textarea name="editor"></textarea>
            </div>
        </div>

    </div>
    <br />
    <div class="row" style="margin-top:10px">
        <div class="col-md-6">
            <video id="my-video"
                   style="max-width: 100%; height: auto; width:auto"
                   @*autoplay*@
                   controls>
                <source src="" type="video/mp4" />
                <source src="" type="video/webm" />
            </video>
        </div>
        <div class="col-md-6">
            <h5>Video url</h5>

            <input class="form-control" type="text" id="txt_url" />
            <span class="focus-input"></span>
            <button type="button" style="margin-top:10px" class="btn btn-primary" onclick="check_video()"><i class="fas fa-search"></i></button>
            <button type="button" style="margin-top:10px" class="btn btn-primary" onclick="reset()"><i class="fas fa-sync"></i></button>
            <button type="button" style="margin-top:10px" class="btn btn-danger" onclick="location.href ='/AdminManage/ManageCourse'">Hủy</button>
            <button type="button" style="margin-top:10px" class="btn btn-success" onclick="update_chapter()">Lưu</button>
        </div>
    </div>


</div>


<script>


    $(document).ready(function () {


        get_chapter()
        CKEDITOR.replace('editor', {
            width: "100%",
            height: "400px",
            uiColor: '#F5F5F5',
            allowedContent: true,
            extraPlugins: 'codesnippet',
            codeSnippet_languages: {}
        });

    });


    function update_chapter() {
        var data = CryptoJS.AES.encrypt(CKEDITOR.instances.editor.getData(), get_id()).toString();
        $.post("../api/chinhsuabaihoc", {
            MaBaiHoc: get_id(),
            Video: $("#txt_url").val(),
            GioiThieu: $("#txt_tenbh").val(),
            LyThuyet: data
        }).done(function (data) {
            if (data.msg != "error")
                swal("Thông báo", "Lưu khóa học thành công", "success").then((value) => {
                    window.location = "/AdminManage/ManageCourse"
                });
            else swal("Lỗi ", "Đã có lỗi xảy ra !" + data.msg, "error");
        }).fail(function (data) {
            swal("Lỗi ", "Đã có lỗi xảy ra !" + data.msg, "error");
        });
    }


    function get_id() {
        var url_string = window.location.href
        var url = new URL(url_string);
        var param = url.searchParams.get("ChapID");
        return param
    }

    function reset() {
        $.get("../api/chitietbaihoc?mabh=" + get_id()).then(function (res) {
            if (res.msg != "error") {
                $("#my-video source").attr("src", res.msg.Video)
                $("#txt_url").val(res.msg.Video)
            }
            $('#my-video')[0].load()
            $('#my-video')[0].play()
        })
    }

    function check_video() {
        $("#my-video source").attr("src", $("#txt_url").val())
        $('#my-video')[0].load()
        $('#my-video')[0].play()
    }

    function get_chapter() {

        $.get("../api/chitietbaihoc?mabh=" + get_id()).then(function (res) {
            if (res.msg != "error") {

                $("#my-video source").attr("src", res.msg.Video)
                $("#txt_url").val(res.msg.Video)
                $("#txt_tenbh").val( res.msg.GioiThieu)
                CKEDITOR.instances['editor'].setData(CryptoJS.AES.decrypt(res.msg.LyThuyet, get_id()).toString(CryptoJS.enc.Utf8))


                /*  $("#LyThuyet").append(CryptoJS.AES.decrypt(res.msg.LyThuyet, get_id()).toString(CryptoJS.enc.Utf8))*/

                $("#chaptermodal").modal("hide")


            }
            $("#Chapterinfo").modal("show")


            $('#my-video')[0].load()
           /* $('#my-video')[0].play()*/
        })
    }

    

</script>

